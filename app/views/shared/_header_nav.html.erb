<header class="sticky top-0 z-40 border-b bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60">
  <div class="max-w-sm mx-auto px-4 h-12 flex items-center justify-between">
    <!-- 左：ロゴ/タイトル -->
    <%= link_to (defined?(root_path) ? root_path : "#"), class: "flex items-center gap-2 font-semibold" do %>
      <span>StreakMate</span>
    <% end %>

    <!-- 右：通知/プロフィール（md以上は横並び、smではアイコンのみ） -->
    <div class="hidden md:flex items-center gap-3">
      <%= link_to (defined?(notifications_path) ? notifications_path : "#"),
                  class: "relative inline-flex items-center" do %>
        <span class="sr-only">通知</span>
        <!-- アイコン -->
        <svg viewBox="0 0 24 24" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.8">
          <path d="M6 8a6 6 0 1 1 12 0c0 7 3 7 3 9H3c0-2 3-2 3-9" />
          <path d="M9 20a3 3 0 0 0 6 0" />
        </svg>
        <%# 未読があれば赤丸を出す: unread_count を適宜差し替え %>
        <% if defined?(current_user) && current_user.respond_to?(:unread_notifications_count) && current_user.unread_notifications_count.to_i > 0 %>
          <span class="absolute -top-1 -right-1 inline-block h-2 w-2 rounded-full bg-red-500"></span>
        <% end %>
      <% end %>

      <div data-controller="menu" class="relative">
        <button data-action="click->menu#toggle" class="flex items-center gap-2">
          <span class="text-sm"><%= current_user&.nickname || "Guest" %></span>
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor"><path d="M7 10l5 5 5-5"/></svg>
        </button>
        <div data-menu-target="panel" class="absolute right-0 mt-2 w-44 rounded-lg border bg-white shadow hidden">
          <%= link_to "My page", (defined?(mypage_path) ? mypage_path : "#"), class: "block px-3 py-2 text-sm hover:bg-gray-50" %>
          <%= link_to "Settings", (defined?(edit_user_registration_path) ? edit_user_registration_path : "#"), class: "block px-3 py-2 text-sm hover:bg-gray-50" %>
          <% if defined?(destroy_user_session_path) %>
            <%= link_to "Log out", destroy_user_session_path, data: { turbo_method: :delete }, class: "block px-3 py-2 text-sm text-red-600 hover:bg-red-50" %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- モバイル：右上にベルとハンバーガー -->
    <div class="md:hidden flex items-center gap-3">
      <%= link_to (defined?(notifications_path) ? notifications_path : "#"), class: "inline-flex" do %>
        <svg viewBox="0 0 24 24" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.8">
          <path d="M6 8a6 6 0 1 1 12 0c0 7 3 7 3 9H3c0-2 3-2 3-9" />
          <path d="M9 20a3 3 0 0 0 6 0" />
        </svg>
      <% end %>
      <button data-controller="menu" data-action="click->menu#toggle" aria-label="open menu">
        <svg viewBox="0 0 24 24" class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="1.8">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- モバイルのドロワー -->
  <div data-controller="menu" data-menu-target="panel" class="md:hidden hidden border-t">
    <nav class="max-w-sm mx-auto px-4 py-2">
      <ul class="flex flex-col">
        <li><%= link_to "My page", (defined?(mypage_path) ? mypage_path : "#"), class: "block px-2 py-2 hover:bg-gray-50 rounded" %></li>
        <li><%= link_to "Settings", (defined?(edit_user_registration_path) ? edit_user_registration_path : "#"), class: "block px-2 py-2 hover:bg-gray-50 rounded" %></li>
        <% if defined?(destroy_user_session_path) %>
          <li><%= link_to "Log out", destroy_user_session_path, data: { turbo_method: :delete }, class: "block px-2 py-2 text-red-600 hover:bg-red-50 rounded" %></li>
        <% end %>
      </ul>
    </nav>
  </div>
</header>
