<div class="space-y-6">
  <div class="text-sm text-gray-600">
    <%= link_to goals_path, class: "underline inline-flex items-center gap-1.5" do %>
      <%= icon "arrow-left", size: "w-4 h-4", "aria-hidden": "true" %>
      <span>一覧に戻る</span>
    <% end %>
  </div>

  <h1 class="text-2xl font-bold"><%= @goal.title %></h1>

  <div class="text-xs text-gray-600">
    <%= @goal.user.nickname.presence || @goal.user.email %> ・
    <%= l @goal.created_at, format: :long %> ・
    <%= @goal.visibility %>
  </div>

  <div class="flex items-center gap-3">
    <%= render "favorites/button", goal: @goal %>
    <%= x_share_link_to(@goal, text: "目標にチャレンジ中", hashtags: %w[StreakMate 目標]) %>
  </div>

  <p class="whitespace-pre-wrap text-sm"><%= @goal.description %></p>

  <div>
    <h3 class="font-semibold">達成基準</h3>
    <p class="whitespace-pre-wrap text-sm"><%= @goal.success_criteria %></p>
  </div>

  <p class="text-sm text-gray-700">カテゴリ：<%= @goal.category.name %></p>

  <% if @goal.user_id == current_user.id %>
    <div class="space-x-1 text-sm">
      <%= link_to edit_goal_path(@goal), class: "inline-flex items-center gap-1.5 px-2 py-1 rounded hover:bg-gray-50 text-blue-600" do %>
        <%= icon "pencil-square", size: "w-4 h-4", "aria-hidden": "true" %>
        <span>編集</span>
      <% end %>
      <%= link_to goal_path(@goal),
                  data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                  class: "inline-flex items-center gap-1.5 px-2 py-1 rounded hover:bg-red-50 text-red-600" do %>
        <%= icon "trash", size: "w-4 h-4", "aria-hidden": "true" %>
        <span>削除</span>
      <% end %>
    </div>
  <% end %>

  <!-- === ゴール配下タスク === -->
<div class="mt-8 pb-footer-lg">   <!-- ← ここを pb-footer → pb-footer-lg に -->
  <h3 class="font-semibold mb-2">タスク</h3>

  <% if @goal.user_id == current_user.id %>
    <%= render "goals/new_task_form", goal: @goal %>
  <% end %>

  <%= turbo_frame_tag "goal_tasks" do %>
    <ul id="goal_tasks_list"
        class="space-y-2"
        <% if @goal.user_id == current_user.id %>
          data-controller="sortable"
          data-sortable-url-value="<%= reorder_goal_goal_tasks_path(@goal) %>"
        <% end %>>
      <% (@tasks || @goal.goal_tasks.incomplete).each do |task| %>
        <%= render "goals/task_row",
                   goal: @goal, task: task,
                   mine: (@goal.user_id == current_user.id) %>
      <% end %>
    </ul>
  <% end %>
</div>
